[{"name":"app.R","content":"library(shiny)\nlibrary(shinyMatrix)\nlibrary(expm)\n\n# Simulation of the popualtion growth\nmatrix_model <- function(mat,init,generations) {\n  pop <- matrix(init,nrow=1)\n  for (gen in generations) {\n    pop_t  <- (mat %^% gen) %*% init\n    pop <- rbind(pop, t(pop_t))\n  }\n  return(structure(list(pop_size = pop, time = c(0,generations)),class=\"mod_results\"))\n}\n# mmm <- matrix(c(0,0.8,1.3,0),nrow=2)\n# init <- c(50,50)\n# rrr <- matrix_model(mmm,init,1:100)\nplot.mod_results <- function(mod, display_cohorts = FALSE) {\n  sums <- rowSums(mod$pop_size)\n  plot(sums~mod$time,type=\"l\",ylim=c(0,max(sums)),xlab=\"generace\",ylab=\"velikost populace\",lwd=2)\n  if (display_cohorts) {\n    n_coh <- ncol(mod$pop_size)\n    for (i in 1:n_coh) {\n      lines(mod$time,mod$pop_size[,i],lty=i+1)\n    }\n    legend(\"topleft\",legend = paste(\"kohorta\",1:n_coh),lty=2:(n_coh+1))\n  }\n}\n# plot(rrr, TRUE)\n\n\n# Define UI for application that draws a histogram\nui <- fluidPage(\n    # Application title\n    titlePanel(\"Věkově specifický model populačního růstu\"),\n\n    # Sidebar with a slider input for number of bins \n    fluidRow(plotOutput(\"pop_growth\")),\n    fluidRow(\n      column(\n        3,\n         numericInput(\"n_cohorts\",\"Počet věkových kohort\", value=2,min=1),\n         sliderInput(\n           \"generations\",\n            \"Délka simulace (počet generací)\",\n             min = 1,\n             max = 250,\n             value = 100\n          ),\n        checkboxInput(\"display_cohorts\",\"Zobrazit věkové kohorty v grafu\")\n       ),\n      column(\n        6,\n        h5(\"Projekční matice\"),\n        matrixInput(\"pop_matrix\", value = matrix(c(0,0.8,1.3,0),nrow=2), rows=list(names=F),cols=list(names=F),class=\"numeric\"),\n      ),\n      column(\n        h5(\"Počáteční velikost populace (pro jednotlivé kohorty)\"),\n        matrixInput(\"init_vector\", value = matrix(rep(50,2),ncol=1), rows=list(names=F),cols=list(names=F),class=\"numeric\")\n      )\n    )\n)\n\n# Define server logic required to draw a histogram\nserver <- function(input, output, session) {\n    observeEvent(input$n_cohorts, {\n      mat <- input$pop_matrix \n      vec <- input$init_vector\n      newdim <- input$n_cohorts\n      if (dim(mat)[1] > newdim) {\n        new <- matrix(mat[1:newdim,1:newdim],nrow=newdim,ncol=newdim)\n        new_vec <- matrix(vec[1:newdim,1],nrow=newdim,ncol=1)\n      } else if (dim(mat)[1]==newdim) {\n        new <- mat\n        new_vec <- vec\n      } else {\n        new <- matrix(0, ncol=newdim, nrow=newdim)\n        new[1:dim(mat)[1], 1:dim(mat)[1]] <- mat\n        new_vec <- matrix(0, ncol=1, nrow=newdim)\n        new_vec[1:dim(mat)[1],1] <- vec\n      }\n      updateMatrixInput(session, \"pop_matrix\", new)\n      updateMatrixInput(session, \"init_vector\", new_vec)\n    })\n    output$pop_growth <- renderPlot({\n        # generate bins based on input$bins from ui.R\n      plot(matrix_model(input$pop_matrix,input$init_vector,1:input$generations),input$display_cohorts)\n    })\n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n","type":"text"}]
